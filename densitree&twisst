#get tree data
  scp -ri ~/.ssh/satokan1-key-ecdsa satokan1@puhti.csc.fi:'/scratch/project_2001443/barriers_introgr_formica_revision/phyml/minsites20.minsnps10.*' \
    '/Users/inasatokangas/Library/CloudStorage/OneDrive-UniversityofHelsinki/PhD/4_formica_local_genomics/DensiTree'


### DENSITREE


#Run DensiTree
cd /Users/inasatokangas/Library/CloudStorage/OneDrive-UniversityofHelsinki/PhD/4_formica_local_genomics/DensiTree
java -jar DensiTree.v3.1.0.jar minsites20.minsnps10.phyml_bionj.trees


### TWISST



#Create sample lists for TWISST
FULLSAMPLE=/scratch/project_2001443/barriers_introgr_formica_revision/phyml/sample_table.tab
bcftools query -l cds_only.vcf.gz > trees_ind.list

#Add species info to the individuals we built the gene trees for

awk '
NR==FNR {
  if (FNR>1) sp[$1]=$3   # skip header
  next
}
{
  print $1 "\t" (sp[$1] ? sp[$1] : "NA")
}
' sample_table.tab trees_ind.list > trees_ind_with_species.list

GROUPTMP=trees_ind_with_species.list
cat $GROUPTMP > tmpfile
perl -pe 's/\t/_A\t/' tmpfile > tmpfileA
perl -pe 's/\t/_B\t/' tmpfile > tmpfileB
cat tmpfileA tmpfileB | sort > groupfile_genetrees.tab
rm tmpfile tmpfileA tmpfileB  # additionally, remove manually "_A" AND "Fexs_B" if exsecta is included

GROUPFILE=/scratch/project_2001443/barriers_introgr_formica_revision/phyml/groupfile_genetrees.tab

### twisst

#run twisst.sh

  
#!/bin/bash -l
#SBATCH -J twisst
#SBATCH -o /scratch/project_2001443/barriers_introgr_formica_revision/twisst/logs/twisst.out
#SBATCH -e /scratch/project_2001443/barriers_introgr_formica_revision/twisst/logs/twisst.err
#SBATCH --account=project_2001443
#SBATCH -t 10:00:00
#SBATCH -p small
#SBATCH --ntasks=4
#SBATCH --mem=8G
#SBATCH --mail-type=END

cd /scratch/project_2001443/barriers_introgr_formica_revision/twisst
export PATH="/projappl/project_2001443/ete3env/bin:$PATH"

GROUPFILE=/scratch/project_2001443/barriers_introgr_formica_revision/phyml/groupfile_genetrees.tab

python3.6 /projappl/project_2001443/twisst/twisst.py \
-t "/scratch/project_2001443/barriers_introgr_formica_revision/phyml/minsites20.minsnps10.phyml_bionj.trees.gz" \
-w "/scratch/project_2001443/barriers_introgr_formica_revision/phyml/minsites20.minsnps10.phyml_bionj.weights.csv.gz" \
-g prat \
-g aqu \
-g rufa \
-g pol \
-g lug \
-g exsecta \
--outgroup exsecta \
--groupsFile $GROUPFILE

#END.
